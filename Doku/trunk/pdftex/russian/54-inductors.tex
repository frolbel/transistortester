\section{Измерение индуктивностей }
Измерение величины индуктивности будет проведено, если  элемент определён как резистор сопротивлением 
ниже \(2100~\Omega\).
Метод измерения основан на росте тока по формуле:

\(Il~=~Imax~\cdot~(1~-~\exp{\frac{-t}{\tau}})\) 
после включения тока. Постоянная  времени \(\tau = \frac{L}{R}\) прямо пропорциональна индуктивности~\(L\), 
и обратно пропорциональна сопротивлению~\(R\). 
Ток может измеряться косвенно по падению напряжения на измерительном сопротивлении.

К сожалению, постоянная времени будет уменьшена дополнительным, относительно высоким, 
сопротивлением \(680~\Omega\), при этом измерение небольших значений индуктивности дополнительно затрудняется 
на частоте \(8~MHz\). Чтобы получить постоянную времени, напряжение на резисторе \(680~\Omega\) будет 
контролироваться  аналоговым компаратором. Если падение напряжения на резисторе \(680~\Omega\) будет выше, 
чем напряжение внутренней опоры, то это событие будет зарегистрировано 16-битным счётчиком, который запускается 
в момент включения тока. Счётчик сохранит состояние этого события. Если счётчик переполнится, то это будет 
подсчитано программой. После наступления события превышения, счётчик будет остановлен программой, и полное 
время состояния счетчика и счётчика переполнений будет сохранено. Положительная сторона катушки будет переключена 
от VCC к GND и будет оставаться в этом состоянии, пока проверка напряжения обоих выводов не покажет отсутствие тока. 
Рисунок~\ref{fig:Inductance} показывает упрощенную схему измерения индуктивности.
\begin{figure}[H]
\centering
\includegraphics[]{../FIG/Inductance.eps}
\caption{Измерение индуктивности с компаратором}
\label{fig:Inductance}
\end{figure}

Вычисляем максимальный ток Imax, как отношение напряжения VCC к сумме всех резисторов в электрической цепи, и 
отношение опорного напряжения к максимальному напряжению на резисторе \(680~\Omega\), которое, в свою очередь, 
вычисляется по формуле \(Umax~=~Imax~\cdot~(680~+~19)\).
Индуктивность вычисляем по формуле \(L~=~-\frac{t~\cdot~Rges}{\log{(1~-~\frac{Uref}{Umax})}}\) .
Натуральный логарифм берут из таблицы. Для этого типа измерения выбрано разрешение индуктивности \(0,1~mH\).

Если величина сопротивления индуктивности будет менее \(24~\Omega\), то для того, чтобы измерить более низкие 
значения индуктивности, в цепи тока не будет использоваться резистор \(680~\Omega\). Для измерения тока будет 
использоваться только выходное сопротивление порта (\(19~\Omega\)). В этом случае пиковый ток будет больше, чем 
допустимое значение для ATmega. Поскольку это будет только в течение очень короткого промежутка времени, я не 
ожидаю повреждения портов ATmega. Для этого типа измерения выбрано разрешение индуктивности \(0,01~mH\). Чтобы 
избежать более длительного времени с чрезмерным током, дополнительное измерение с задержанным запуском счётчика 
будет всегда проводиться с резистором \(680~\Omega\). Чтобы получить более подходящие результаты измерения, 
смещение нуля 6 вычитают из счётчика, если измерение сделано без резистора \(680~\Omega\). Иначе вычитается 
смещение нуля 7 или 8.

При больших значениях индуктивности, паразитная ёмкость может вызвать быстрый рост тока, так, что компаратор 
срабатывает немедленно. Чтобы в этом случае получить значение индуктивности, измерение будет повторено с 
задержанным запуском счётчика. Этим методом аналоговым компаратором будет обнаружено напряжение, вызванное 
увеличением тока индуктивности, вместо напряжения от пика тока паразитной ёмкости. Измерения всегда делаются 
в обоих направлениях тока. Программа выберет более высокий результат измерения в том же самом направлении тока, 
а на дисплей будет выведен более низкий результат различных направлений тока.

\subsection{Результаты измерений индуктивности}
Рисунок~\ref{fig:Induct328p} показывает результаты измерения различных катушек.
Катушки выше \(1~H\) - реле или первичные обмотки силовых трансформаторов затрудняют измерения, потому что 
у железного сердечника есть остаточное намагничивание.

\begin{figure}[H]
\centering
\input{../GNU/induct328p}
\caption{Погрешность измерения индуктивности для 15-ти различных ATmega}
\label{fig:Induct328p}
\end{figure}

\subsection{Измерение малых индуктивностей методом отбора проб}
Наименьшая индуктивность, которая может быть обнаружена при нормальном методе измерений \(0,01~mH\).
Для измерения небольшой индуктивности требуется высокая частота.
Обычный метод использует измерение скорости нарастания тока при измерении индуктивности.
Этот метод не может быть использован для метода выборки, поскольку схема измерения не использует никаких дополнительных
резисторов при испытании катушки. Ток будет расти до критически высоких значений очень быстро.
Мы можем предотвратить повреждение ATmega только с очень быстрым отключением тока.
Для выборочного метода трудно реализовать быстрое отключение и кроме того, этот критический процесс должен быть
повторен много раз в серии испытаний.

Радиолюбитель Pieter-Tjerk (PA3FWM) реализовал другой метод, чтобы получить значение индуктивности.
Параллельным подключением конденсатора к индуктивности создается резонансный контур.
С помощью короткого импульса тока эта схема возбуждается и начинает колебаться.
Используя метод дискретизации, измеряется частота этого колебания.
Так как при этом измерении один вывод катушки подключен к GND возникают две проблемы с измерением.
Отрицательное напряжение колебаний ограничивает внутренний диод защиты на порту ATmega примерно до \(0,6~V\).
По этой причине положительная часть колебаний тоже никогда не достигнет напряжения выше чем \(0,6~V\).
Кроме того АЦП в ATmega может измерять только позитивные значения напряжения.
Таким образом, все отрицательные части колебаний считываются как нулевые.
В любом случае, Pieter-Tjerk нашел решение, чтобы измерить резонансную частоту с практической точностью.
Если значение ёмкости известно и можно измерить резонансную частоту, то индуктивность может быть вычислена.
По этой причине программа калибровки нуждается в конденсаторе фиксированной ёмкости для
дальнейшего использования при измерении малых значений индуктивности.
Во время самотеста будет предложено подключить конденсатор в шаге «\mbox{1 \electricC 3 \(10-30nF\)(L)}».
Для не откалиброванного тестера, по умолчанию, выбрано значение \(18~nF\).
Значение ёмкости параллельного конденсатора для измерения индуктивности должно быть выбрано
таким, чтобы получить резонансную частоту для всего диапазона значений измеряемых малых индуктивностей.
Конденсатор высокого качества (фольгового типа) должен быть выбран потому,
что дополнительно измеряется добротность резонансного контура путем мониторинга уменьшение амплитуды.
При использовании конденсатора высокого качества общая добротность резонансного контура будет 
определятся добротностью катушки.

Никаких дополнительных действий не требуется при параллельном подключении конденсатора.
Резонансный контур, как правило, определяется автоматически.
При обнаружении резонансного контура, отображается текст «if» и значение параллельной ёмкости
отображается за значением индуктивности в строке 2.
В этом случае величина сопротивления катушки отображается в конце строки 1.
Значение сопротивления катушки Вы должны проверить отдельно, измерив его без конденсатора,
потому что измерение сопротивления в резонансном контуре невозможно!
В дополнительной строке отображается измеренное значение резонансной частоты и добротность (\(Q~=\)) контура.
Если резонансный контур не обнаружен, значение сопротивления и индуктивности отображается в строке 2.
Для резонансной частоты контура определяется значение частоты и добротность катушки,
которые отображаются в дополнительной строке.

Для воздушной катушки с 6 витками с параллельно подсоединенным конденсатором \(18~nF\) при методе
отбора проб получен следующий результат:
\begin{verbatim}
272nH if 18.0nF
2256kHz Q=38.7
\end{verbatim}
Такой же результат был получен с рабочей частотой от \(8~MHz\).
Также сделаны измерения катушки в один виток из медной проволоки длиной \(25~cm\).
Возможно, меньшие значения индуктивности могут быть измерены с тактовой частотой ATmega \(16~MHz\).

